# 计算机操作系统

## 内核：

### 1、基本组成

- 与硬件密切相关的操作

	与硬件相关的操作大多数是特权指令的操作

- 关键数据结构

	如进程控制块**PCB**、信号量、页表等，这些数据不允许用户直接访问（需要置于内核中加以保护）

- 基本中断处理程序

	中断技术是现代计算机技术的重要组成部分

- 使用频繁的功能模块

	将使用计算机时频繁使用或操作的模块置于内核，可以提高操作系统的性能

### 2、基本特点

- 内存常驻

	常驻（Terminate and Stay Resident, TSR）是指程序装入内存运行完成后，操作系统没有回收所占用的空间，程序仍然保留在内存当中。内核在内存中常驻有利于提高系统的性能（下次使用不用再次从磁盘中装载）

- 运行在核心态

	内核的程序运行在核心态，内核的数据也仅供核心态下程序访问。

### 3、系统区和用户区

内存会被分割成两个部分：系统区和用户区，内核的程序和数据存放在系统区；应用程序、操作系统核外部分的程序、其他系统软件存放于用户区。**需要注意的是**，操作系统的内核可能占用内存多个不同的区域（如内存的低地址部分和高地址部分）

## 操作系统的启动

操作系统的启动依赖于一组特殊的软件，称为系统固件（System Firmware），通常固件的程序和数据存放在一个或多个只读存储器（ROM）芯片中。这些固件极其重要，是**计算机中硬件与软件沟通的桥梁**。

与PC启动有关的固件主要有BIOS（Basic Input/Output System）和UEFI（Unified EFI, Unified Extensible Firmware Interface）。

### BIOS

#### 1、基本组成

BIOS主要包括POST（Power On Self Test）自检程序、基本启动程序、基本硬件驱动程序和中断处理程序。

1. POST自检程序

	POST自检程序又称为自诊断测试程序。主要功能是识别系统的硬件配置，并根据这些配置对系统中各部件进行自检和初始化。用户开启计算机系统的电源，机器的电源供电稳定后，处理器复位，并运行ROM BIOS的POST自检程序。

2. 基本启动程序

	主要功能是检查和运行引导程序。POST自检成功后，基本启动程序按照系统设置的优先级顺序，依次检查指定的启动设备存储介质的引导区（Boot Block）是否包含有效的操作系统引导程序。一旦发现，就将引导区中的引导程序读入**[0000:7C00]**地址开始的内存中，并执行该地址开始的引导程序

3. 基本硬件驱动程序和中断处理程序

	基本硬件驱动程序和中断处理程序指系统的基本I/O设备（如键盘、鼠标、显卡、硬盘等）的驱动程序及其基本的中断服务程序。INT 13H是磁盘操作的处理程序（在操作系统启动前，唯一的磁盘读操作的途径），INT 19H：引导装入程序、INT 10H：视频处理程序、INT 16H：键盘处理程序

#### 2、主引导记录

BIOS采用主引导记录（Master Boot Record, MBR）管理磁盘分区。

MBR结构

|     结构      | 字节偏移量/B | 字节数/B |                    说明                     |
| :-----------: | :----------: | :------: | :-----------------------------------------: |
|   BootCode    |      0       |   440    |              主引导程序（MBR）              |
| DiskSignature |     440      |    4     |            磁盘签名（signature）            |
|    Unknown    |     444      |    2     |                  [未定义]                   |
|     DPT1      |     446      |    16    |              第一个分区表DPT1               |
|     DPT2      |     462      |    16    |              第二个分区表DPT2               |
|     DPT3      |     478      |    16    |              第三个分区表DPT3               |
|     DPT4      |     494      |    16    |              第四个分区表DPT4               |
|   Signature   |     510      |    2     | 结束标志符（BRID）: 55H AAH（Magic Number） |