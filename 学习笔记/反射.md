# 反射（Reflection):

Reflection （反射）是 被视为 动态语言 的关键，反射机制允许程序在执行期借助于 Reflection API 取得任何类的内部信息，并能直接操作任意对象的内部属性及方法。加载完类之后 在堆内存的方法区中就产生了一个 Class 类型的对象。一个类只有一个 Class 对象，这个对象就包含了完整的类的结构信息。 我们可以通过这个对象看到类的结构。这个对象就像一面镜子透过这个镜子看到类的结构，所以我们形象的称之为：反射。

正常的加载方式是：先引入“包类”的名称，然后再通过new实例化，最后取得实例化对象。

反射的加载方式是：先取得实例化的对象，然后调用getClass()方法，最后获得完整的“包类”名称。反射的加载方式几乎与正常加载方式相反，更像是在解包。反射的主要实现类是Class类，该类可以看作是所有类的共有结构类。

## Java反射机制提供的功能：

- 在运行时判断任意一个对象所属的类
- 在运行时构造任意一个类的对象
- 在运行时判断任意一个类所具有的成员变量和方法
- 在运行时获取泛型信息
- 在运行时调用任意一个对象的成员变量和方法
- 在运行时处理注解
- 生成动态代理

### 关于反射的一些小问题：

1. 正常的new操作和反射都能够使用构造器创建对象，那么两者的区别是什么？

	大多情况下，使用的是new操作。多数情况下，我们的实例对象在程序运行时就已经确定了，不会再发生更改也不可更改，这时我们采用的就是new操作。这种方式能够满足我们的正常开发需求。但是，当我们开发的Java后端已经启动运行，正式与前端发生交互时，例如登录与注册操作，我们不知道用户会使用哪种操作，这样的对象在程序运行时仍未确定，此时就需要使用反射来进行构造、更改。

2. private就是为了在封装后不被外部类访问，那么反射能够暴力访问的意义何在？

	通常，我们使用权限符就是为了让外部类无法访问，同时也是不希望外部类能够访问（处于某些目的，我们更希望外部调用我们提供的方法）。但是，反射的存在也是不至于让private彻底封死，不能访问。反射相当于留了个后门，必要时能够访问。

## 反射相关的主要API：

- java.lang.Class：代表一个类
- java.lang.reflect.Method：代表类的方法
- java.lang.reflect.Field：代表类的成员变量
- java.lang.reflect.Constructor：代表类的构造器

### Class类：

在类的加载过程中：程序经过javac.exe编译后会生成一个或多个字节码文件（.class）。接着我们使用java.exe命令对某个字节码文件进行解释运行。就相当于将某个字节码文件加载到内存当中，此过程就成为类的加载。加载到内存中的类，我们就成为运行时类，该运行时类，就作为Class类的一个实例。这也体现了Java万物皆对象的思想，这里把类也当作对象（就像与“概念”这一词也需要当作对象被“概念”解释）。一个Class实例就对应着一个运行时类。由于Class对象是运行时类，所以我们在编写代码的时候就无法创建一个该实例（此时还没有运行，不存在运行时类）

#### 获取Class对象的四种方式：

1. 调用运行时类的属性：

	`Class clazz = Person.class;`这种方式是最不常用的，基本上一开始就将Class对象写死了，灵活性差，很难体现动态性。

2. 通过运行时类的对象，调用getClass()：

	`Class clazz2 = new Person().getClass();`

3. 调用Class的静态方法，forName(String Classpath)：

	`Class clazz3 = Class.forName("com.atguigu.java.Person");`这种方式最常用，灵活性更高

4. 使用类的加载器：ClassLoader（了解）：

	JVM在加载运行时类时，会将运行时类保存在内存中一段时间（保证多个该类对象只有一个运行时类）

	~~~java
	ClassLoader classloader = test.class.getClassLoader();
	Class clazz4 = classloader.loadClass("com.atguigu.java.Person");
	~~~

	

## 动态语言：

其是一类在运行时可以改变其结构的语言：例如新的函数、对象、甚至代码可以被引进，已有的函数可以被删除或是其他结构上的变化。通俗点说就是在运行时代码可以根据某些条件改变自身结构。主要动态语言：Object C、C#、JavaScript、PHP、Python、Erlang 。

## 静态语言：

与动态语言相对应的，运行时结构不可变的语言就是静态语言。如 Java、C、C++。Java不是动态语言，但 Java 可以称之为准动态语言。即 Java 有一定的动态性。我们可以利用反射机制、字节码操作获得类似动态语言的特性。Java 的动态性让编程的时候更加灵活。

//640